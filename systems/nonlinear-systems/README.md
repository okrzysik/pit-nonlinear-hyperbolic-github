This directory implements the nonlinear conservation law examples from the paper `Parallel-in-time solution of hyperbolic PDE systems via characteristic-variable block preconditioning`

Here we solve the nonlinear conservation law   
        q_t +  f(q)_x = 0, (x,t) \in \Omega \times (0,T],
    where f is the (nonlinear) flux function, and q is a vector of ell > 1 conserved variables
    
Examples include: 
    1. Shallow water equations (SWE), where q = (h; u\*h) with h the water height, and u the water velocity
    2. Euler equations of gas dynamics, where q = (rho; rho\*u; E) with rho the gas density, u the gas velocity, and E the total energy of the gas
    
    
Figures 3, 4, 5, 6 from the paper as well as all figures in the supplementary materials can be generated by running the script `cons_law_st.m` with various options configured as described in the paper. Some of the main options in the code that need to be configured are:
* linearized_solver: Specifies if linearized systems are solved directly with sequential time-stepping or via characteristic-variables-based block preconditioning

* prec.blocks: Specifies if diagonal blocks in preconditioner are exactly those of the original discretization transformed into characteristic variables, or if they are based on an approximate Roe-based discretization of the characteristic variable

* prec.type: Soecifies whether diagonal or triangular based block preconditioners are used 

* `PDE, domain and initial condition parameters` These blocks of code specify the PDE, domain, and initial condition. Just uncomment the one that you want to run, ensuring all others are commented out.

*  `MGRIT parameters for space-time linear advection solves`: This block of code sets up the parameters for MGRIT. To reproduce the figures from the paper ensure the same settings are used as described there. 
    
Note: Running `cons_law_st.m` with appropriately configured settings will generate one family of curves shown in the plots in the paper. Multiple families of curves can be overlaid on the same figure, as in the paper, by running 'utils/merge_and_save_figs.m' if each of the underlying plots have been saved. 
    
A description of the main scripts and directories is as follows:
* `cons_law_time_stepping.m` solves the conservation law by sequential time-stepping. This is the most basic script.

* `cons_law_st.m` solves the space-time formulation of the discretized conservation law using an outer iteration based on a global linearization. At each outer iteration, a space-time linear system must be solved that corresponds to a discretiztion of the linear conservation law      e_t + A(q)e_x = 0
    for the linearized error vector e.
    Several options for the linearized systems of equations are available: 
    1. Direct solve via sequential time-stepping. This is not parallelizable, but is useful for testing the effectiveness of the outer iteration and linearization.
    2. Using block preconditioning techniques after changing into the characteristic variables of the linearized problem. After changing into characteristic variables, the space-time problem to be solved is
            \wh{e}^{n+1} = \wh{\Phi}^n \wh{e}^n + \wh{r}^{n+1}
        where \wh{e}^n is a vector with ell blocks, one for each characteristic variable. We then use either a block triangular or block diagonal precondition on this system. Further options include:
            i. preconditioners based on exact blocks from \wh{\Phi}. We don't know explicit formulae for these blocks but we can compute their action numerically so as to test the preconditioners.
            ii. preconditioners are based on approximating the diagonal blocks of \wh{\Phi}. These approximations are based on directly discretizing each of the characteristic variables under the assumption that they globally decouple.
                
* `cons_law_system.m` all codes rely on the basic functionality provided by this base class. Each conservation law is implemented via this class. SWE is `swe_system.m' and Euler is `euler_system.m` 
    Presently, only forward Euler time-stepping is implemented for these problems along with first-order finite-volume (FV) methods in space. For the FV methods, both Roe and local Lax--Friedrichs numerical fluxes are implemented (Note: not all routines are implemented for the LLF flux).
    
* `step_cons_law_lin_char_MGRIT.m` when `cons_law_st.m` uses MGRIT to approximately solve space-time linear conservation laws (i.e., those arising from transforming the linearized system into characteristic variables) this script provides the wrappers required for MGRIT and implements the corrected semi-Lagrangian coarse-grid discretizations, etc.
    
* `utils/` some useful routines for plotting, linearization data, etc.
